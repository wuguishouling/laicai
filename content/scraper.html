<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hattrick Match Data Scraper</title>
    <link rel="stylesheet" type="text/css" href="./resources/css/scraper.css">
</head>

<body>
    <div class="container">
        <header class="header">
            <h1>🔍 Hattrick Match Data Scraper</h1>
            <p class="subtitle">批量抓取比赛数据并导出为 CSV</p>
        </header>

        <main class="main-content">
            <!-- 输入区域 -->
            <section class="input-section">
                <h2>📝 比赛ID设置</h2>

                <div class="input-mode-tabs">
                    <button class="tab-btn active" data-mode="range">ID范围</button>
                    <button class="tab-btn" data-mode="list">ID列表</button>
                </div>

                <div class="input-panel" id="range-panel">
                    <div class="input-group">
                        <label for="start-id">起始ID:</label>
                        <input type="number" id="start-id" placeholder="754129050" min="1">
                    </div>
                    <div class="input-group">
                        <label for="end-id">结束ID:</label>
                        <input type="number" id="end-id" placeholder="754129060" min="1">
                    </div>
                    <div class="match-count" id="range-count">共 0 场比赛</div>
                </div>

                <div class="input-panel hidden" id="list-panel">
                    <div class="input-group">
                        <label for="id-list">比赛ID列表 (逗号或换行分隔):</label>
                        <textarea id="id-list" rows="4"
                            placeholder="754129050, 754129051, 754129052&#10;或每行一个ID"></textarea>
                    </div>
                    <div class="match-count" id="list-count">共 0 场比赛</div>
                </div>
            </section>

            <!-- 选项区域 -->
            <section class="options-section">
                <h2>⚙️ 抓取选项</h2>
                <div class="options-grid">
                    <label class="checkbox-label">
                        <input type="checkbox" id="opt-events" checked>
                        <span>包含比赛事件 (直播文字)</span>
                    </label>
                    <label class="checkbox-label">
                        <input type="checkbox" id="opt-timeline" checked>
                        <span>包含时间线评级</span>
                    </label>
                    <label class="checkbox-label">
                        <input type="checkbox" id="opt-ratings" checked>
                        <span>包含最终评级</span>
                    </label>
                    <label class="checkbox-label"
                        style="grid-column: span 2; margin-top: 10px; padding-top: 10px; border-top: 1px dashed #ccc;">
                        <input type="checkbox" id="opt-use-chpp">
                        <span style="color: #2e7d32; font-weight: bold;">⚡ 使用 CHPP API (极速模式)</span>
                        <span id="chpp-status" style="font-size: 0.9em; margin-left: 5px; color: #666;"></span>
                    </label>
                </div>
                <div class="input-group inline">
                    <label for="interval">请求间隔 (秒):</label>
                    <input type="number" id="interval" value="2" min="1" max="10" step="0.5">
                </div>
            </section>

            <!-- 控制按钮 -->
            <section class="control-section">
                <button class="btn btn-primary" id="btn-start">
                    <span class="btn-icon">▶</span> 开始抓取
                </button>
                <button class="btn btn-warning" id="btn-pause" disabled>
                    <span class="btn-icon">⏸</span> 暂停
                </button>
                <button class="btn btn-success" id="btn-export" disabled>
                    <span class="btn-icon">⬇</span> 导出CSV
                </button>
                <button class="btn btn-danger" id="btn-clear">
                    <span class="btn-icon">🗑</span> 清除数据
                </button>
            </section>

            <!-- 进度区域 -->
            <section class="progress-section hidden" id="progress-section">
                <h2>📊 抓取进度</h2>
                <div class="progress-bar-container">
                    <div class="progress-bar" id="progress-bar"></div>
                    <span class="progress-text" id="progress-text">0%</span>
                </div>
                <div class="progress-stats">
                    <div class="stat">
                        <span class="stat-label">已完成:</span>
                        <span class="stat-value" id="stat-completed">0 / 0</span>
                    </div>
                    <div class="stat">
                        <span class="stat-label">已用时:</span>
                        <span class="stat-value" id="stat-elapsed">00:00</span>
                    </div>
                    <div class="stat">
                        <span class="stat-label">预计剩余:</span>
                        <span class="stat-value" id="stat-remaining">--:--</span>
                    </div>
                </div>
                <div class="status-message" id="status-message">准备就绪</div>
            </section>

            <!-- 错误/警告区域 -->
            <section class="errors-section hidden" id="errors-section">
                <h2>⚠️ 失败记录</h2>
                <div class="errors-list" id="errors-list"></div>
                <button class="btn btn-secondary btn-small" id="btn-retry-failed">
                    重试失败项
                </button>
            </section>

            <!-- 数据预览区域 -->
            <section class="preview-section hidden" id="preview-section">
                <h2>📋 数据预览 <span class="preview-count" id="preview-count">(0 条)</span></h2>
                <div class="preview-table-container">
                    <table class="preview-table" id="preview-table">
                        <thead>
                            <tr>
                                <th>Match ID</th>
                                <th>日期</th>
                                <th>主队</th>
                                <th>比分</th>
                                <th>客队</th>
                                <th>类型</th>
                            </tr>
                        </thead>
                        <tbody id="preview-tbody"></tbody>
                    </table>
                </div>

                <!-- 数据导出区域 -->
                <div class="export-section" style="margin-top: 20px;">
                    <button class="btn btn-success" id="btn-save-file" style="margin-right: 10px;">
                        💾 保存为文件
                    </button>
                    <button class="btn btn-primary" id="btn-show-json" style="margin-right: 10px;">
                        📄 显示JSON
                    </button>
                    <button class="btn btn-secondary" id="btn-copy-data">
                        📋 复制
                    </button>
                </div>
                <div id="export-data-container" style="display: none; margin-top: 15px;">
                    <p style="margin-bottom: 5px; color: #666;">请全选 (Ctrl+A) 并复制 (Ctrl+C) 下面的数据，然后粘贴到记事本保存为 .json 文件：
                    </p>
                    <textarea id="export-data-textarea"
                        style="width: 100%; height: 300px; font-family: monospace; font-size: 12px; padding: 10px; border: 1px solid #ccc; border-radius: 4px;"
                        readonly></textarea>
                </div>
            </section>
        </main>

        <footer class="footer">
            <p>基于 Foxtrick 扩展 | 数据来源: Hattrick.org</p>
        </footer>
    </div>

    <!-- CSV 导出工具 (独立，无依赖) -->
    <script type="application/javascript" src="./util/csv-exporter.js"></script>

    <!-- Scraper 主脚本 -->
    <script type="application/javascript" src="./scraper.js"></script>
</body>

</html>